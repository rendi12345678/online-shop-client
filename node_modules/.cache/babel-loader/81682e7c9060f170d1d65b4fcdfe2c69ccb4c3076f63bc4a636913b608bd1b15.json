{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  loadManifestWithRetries: null,\n  loadComponents: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  loadManifestWithRetries: function () {\n    return loadManifestWithRetries;\n  },\n  loadComponents: function () {\n    return loadComponents;\n  }\n});\nconst _constants = require(\"../shared/lib/constants\");\nconst _path = require(\"path\");\nconst _require = require(\"./require\");\nconst _interopdefault = require(\"../lib/interop-default\");\nconst _tracer = require(\"./lib/trace/tracer\");\nconst _constants1 = require(\"./lib/trace/constants\");\nconst _loadmanifest = require(\"./load-manifest\");\nconst _wait = require(\"../lib/wait\");\nasync function loadManifestWithRetries(manifestPath, attempts = 3) {\n  while (true) {\n    try {\n      return (0, _loadmanifest.loadManifest)(manifestPath);\n    } catch (err) {\n      attempts--;\n      if (attempts <= 0) throw err;\n      await (0, _wait.wait)(100);\n    }\n  }\n}\nasync function loadClientReferenceManifest(manifestPath, entryName) {\n  process.env.NEXT_MINIMAL ? __non_webpack_require__(manifestPath) : require(manifestPath);\n  try {\n    return globalThis.__RSC_MANIFEST[entryName];\n  } catch (err) {\n    return undefined;\n  }\n}\nasync function loadComponentsImpl({\n  distDir,\n  page,\n  isAppPath\n}) {\n  let DocumentMod = {};\n  let AppMod = {};\n  if (!isAppPath) {\n    [DocumentMod, AppMod] = await Promise.all([Promise.resolve().then(() => (0, _require.requirePage)(\"/_document\", distDir, false)), Promise.resolve().then(() => (0, _require.requirePage)(\"/_app\", distDir, false))]);\n  }\n  const ComponentMod = await Promise.resolve().then(() => (0, _require.requirePage)(page, distDir, isAppPath));\n  // Make sure to avoid loading the manifest for Route Handlers\n  const hasClientManifest = isAppPath && (page.endsWith(\"/page\") || page === \"/not-found\" || page === \"/_not-found\");\n  const [buildManifest, reactLoadableManifest, clientReferenceManifest, serverActionsManifest] = await Promise.all([loadManifestWithRetries((0, _path.join)(distDir, _constants.BUILD_MANIFEST)), loadManifestWithRetries((0, _path.join)(distDir, _constants.REACT_LOADABLE_MANIFEST)), hasClientManifest ? loadClientReferenceManifest((0, _path.join)(distDir, \"server\", \"app\", page.replace(/%5F/g, \"_\") + \"_\" + _constants.CLIENT_REFERENCE_MANIFEST + \".js\"), page.replace(/%5F/g, \"_\")) : undefined, isAppPath ? loadManifestWithRetries((0, _path.join)(distDir, \"server\", _constants.SERVER_REFERENCE_MANIFEST + \".json\")).catch(() => null) : null]);\n  const Component = (0, _interopdefault.interopDefault)(ComponentMod);\n  const Document = (0, _interopdefault.interopDefault)(DocumentMod);\n  const App = (0, _interopdefault.interopDefault)(AppMod);\n  const {\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n    routeModule\n  } = ComponentMod;\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    ComponentMod,\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n    clientReferenceManifest,\n    serverActionsManifest,\n    isAppPath,\n    page,\n    routeModule\n  };\n}\nconst loadComponents = (0, _tracer.getTracer)().wrap(_constants1.LoadComponentsSpan.loadComponents, loadComponentsImpl);","map":{"version":3,"names":["loadManifestWithRetries","loadComponents","manifestPath","attempts","_loadmanifest","loadManifest","err","_wait","wait","loadClientReferenceManifest","entryName","process","env","NEXT_MINIMAL","__non_webpack_require__","require","globalThis","__RSC_MANIFEST","undefined","loadComponentsImpl","distDir","page","isAppPath","DocumentMod","AppMod","Promise","all","resolve","then","_require","requirePage","ComponentMod","hasClientManifest","endsWith","buildManifest","reactLoadableManifest","clientReferenceManifest","serverActionsManifest","_path","join","_constants","BUILD_MANIFEST","REACT_LOADABLE_MANIFEST","replace","CLIENT_REFERENCE_MANIFEST","SERVER_REFERENCE_MANIFEST","catch","Component","_interopdefault","interopDefault","Document","App","getServerSideProps","getStaticProps","getStaticPaths","routeModule","pageConfig","config","_tracer","getTracer","wrap","_constants1","LoadComponentsSpan"],"sources":["../../src/server/load-components.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}