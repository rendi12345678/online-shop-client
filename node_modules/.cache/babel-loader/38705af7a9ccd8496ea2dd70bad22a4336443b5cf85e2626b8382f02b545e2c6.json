{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  sendStatusCode: null,\n  redirect: null,\n  checkIsOnDemandRevalidate: null,\n  COOKIE_NAME_PRERENDER_BYPASS: null,\n  COOKIE_NAME_PRERENDER_DATA: null,\n  RESPONSE_LIMIT_DEFAULT: null,\n  SYMBOL_PREVIEW_DATA: null,\n  SYMBOL_CLEARED_COOKIES: null,\n  clearPreviewData: null,\n  ApiError: null,\n  sendError: null,\n  setLazyProp: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  sendStatusCode: function () {\n    return sendStatusCode;\n  },\n  redirect: function () {\n    return redirect;\n  },\n  checkIsOnDemandRevalidate: function () {\n    return checkIsOnDemandRevalidate;\n  },\n  COOKIE_NAME_PRERENDER_BYPASS: function () {\n    return COOKIE_NAME_PRERENDER_BYPASS;\n  },\n  COOKIE_NAME_PRERENDER_DATA: function () {\n    return COOKIE_NAME_PRERENDER_DATA;\n  },\n  RESPONSE_LIMIT_DEFAULT: function () {\n    return RESPONSE_LIMIT_DEFAULT;\n  },\n  SYMBOL_PREVIEW_DATA: function () {\n    return SYMBOL_PREVIEW_DATA;\n  },\n  SYMBOL_CLEARED_COOKIES: function () {\n    return SYMBOL_CLEARED_COOKIES;\n  },\n  clearPreviewData: function () {\n    return clearPreviewData;\n  },\n  ApiError: function () {\n    return ApiError;\n  },\n  sendError: function () {\n    return sendError;\n  },\n  setLazyProp: function () {\n    return setLazyProp;\n  }\n});\nconst _headers = require(\"../web/spec-extension/adapters/headers\");\nconst _constants = require(\"../../lib/constants\");\nfunction sendStatusCode(res, statusCode) {\n  res.statusCode = statusCode;\n  return res;\n}\nfunction redirect(res, statusOrUrl, url) {\n  if (typeof statusOrUrl === \"string\") {\n    url = statusOrUrl;\n    statusOrUrl = 307;\n  }\n  if (typeof statusOrUrl !== \"number\" || typeof url !== \"string\") {\n    throw new Error(`Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`);\n  }\n  res.writeHead(statusOrUrl, {\n    Location: url\n  });\n  res.write(url);\n  res.end();\n  return res;\n}\nfunction checkIsOnDemandRevalidate(req, previewProps) {\n  const headers = _headers.HeadersAdapter.from(req.headers);\n  const previewModeId = headers.get(_constants.PRERENDER_REVALIDATE_HEADER);\n  const isOnDemandRevalidate = previewModeId === previewProps.previewModeId;\n  const revalidateOnlyGenerated = headers.has(_constants.PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER);\n  return {\n    isOnDemandRevalidate,\n    revalidateOnlyGenerated\n  };\n}\nconst COOKIE_NAME_PRERENDER_BYPASS = `__prerender_bypass`;\nconst COOKIE_NAME_PRERENDER_DATA = `__next_preview_data`;\nconst RESPONSE_LIMIT_DEFAULT = 4 * 1024 * 1024;\nconst SYMBOL_PREVIEW_DATA = Symbol(COOKIE_NAME_PRERENDER_DATA);\nconst SYMBOL_CLEARED_COOKIES = Symbol(COOKIE_NAME_PRERENDER_BYPASS);\nfunction clearPreviewData(res, options = {}) {\n  if (SYMBOL_CLEARED_COOKIES in res) {\n    return res;\n  }\n  const {\n    serialize\n  } = require(\"next/dist/compiled/cookie\");\n  const previous = res.getHeader(\"Set-Cookie\");\n  res.setHeader(`Set-Cookie`, [...(typeof previous === \"string\" ? [previous] : Array.isArray(previous) ? previous : []), serialize(COOKIE_NAME_PRERENDER_BYPASS, \"\", {\n    // To delete a cookie, set `expires` to a date in the past:\n    // https://tools.ietf.org/html/rfc6265#section-4.1.1\n    // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n    expires: new Date(0),\n    httpOnly: true,\n    sameSite: process.env.NODE_ENV !== \"development\" ? \"none\" : \"lax\",\n    secure: process.env.NODE_ENV !== \"development\",\n    path: \"/\",\n    ...(options.path !== undefined ? {\n      path: options.path\n    } : undefined)\n  }), serialize(COOKIE_NAME_PRERENDER_DATA, \"\", {\n    // To delete a cookie, set `expires` to a date in the past:\n    // https://tools.ietf.org/html/rfc6265#section-4.1.1\n    // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n    expires: new Date(0),\n    httpOnly: true,\n    sameSite: process.env.NODE_ENV !== \"development\" ? \"none\" : \"lax\",\n    secure: process.env.NODE_ENV !== \"development\",\n    path: \"/\",\n    ...(options.path !== undefined ? {\n      path: options.path\n    } : undefined)\n  })]);\n  Object.defineProperty(res, SYMBOL_CLEARED_COOKIES, {\n    value: true,\n    enumerable: false\n  });\n  return res;\n}\nclass ApiError extends Error {\n  constructor(statusCode, message) {\n    super(message);\n    this.statusCode = statusCode;\n  }\n}\nfunction sendError(res, statusCode, message) {\n  res.statusCode = statusCode;\n  res.statusMessage = message;\n  res.end(message);\n}\nfunction setLazyProp({\n  req\n}, prop, getter) {\n  const opts = {\n    configurable: true,\n    enumerable: true\n  };\n  const optsReset = {\n    ...opts,\n    writable: true\n  };\n  Object.defineProperty(req, prop, {\n    ...opts,\n    get: () => {\n      const value = getter();\n      // we set the property on the object to avoid recalculating it\n      Object.defineProperty(req, prop, {\n        ...optsReset,\n        value\n      });\n      return value;\n    },\n    set: value => {\n      Object.defineProperty(req, prop, {\n        ...optsReset,\n        value\n      });\n    }\n  });\n}","map":{"version":3,"names":["sendStatusCode","redirect","checkIsOnDemandRevalidate","COOKIE_NAME_PRERENDER_BYPASS","COOKIE_NAME_PRERENDER_DATA","RESPONSE_LIMIT_DEFAULT","SYMBOL_PREVIEW_DATA","SYMBOL_CLEARED_COOKIES","clearPreviewData","ApiError","sendError","setLazyProp","res","statusCode","statusOrUrl","url","Error","writeHead","Location","write","end","req","previewProps","headers","_headers","HeadersAdapter","from","previewModeId","get","_constants","PRERENDER_REVALIDATE_HEADER","isOnDemandRevalidate","revalidateOnlyGenerated","has","PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER","Symbol","options","serialize","require","previous","getHeader","setHeader","Array","isArray","expires","Date","httpOnly","sameSite","process","env","NODE_ENV","secure","path","undefined","Object","defineProperty","value","enumerable","constructor","message","statusMessage","prop","getter","opts","configurable","optsReset","writable","set"],"sources":["../../../src/server/api-utils/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}