{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"sendResponse\", {\n  enumerable: true,\n  get: function () {\n    return sendResponse;\n  }\n});\nconst _pipereadable = require(\"./pipe-readable\");\nconst _utils = require(\"./web/utils\");\nasync function sendResponse(req, res, response, waitUntil) {\n  // Don't use in edge runtime\n  if (process.env.NEXT_RUNTIME !== \"edge\") {\n    var\n    // Copy over the response headers.\n    _response_headers;\n    // Copy over the response status.\n    res.statusCode = response.status;\n    res.statusMessage = response.statusText;\n    (_response_headers = response.headers) == null ? void 0 : _response_headers.forEach((value, name) => {\n      // The append handling is special cased for `set-cookie`.\n      if (name.toLowerCase() === \"set-cookie\") {\n        // TODO: (wyattjoh) replace with native response iteration when we can upgrade undici\n        for (const cookie of (0, _utils.splitCookiesString)(value)) {\n          res.appendHeader(name, cookie);\n        }\n      } else {\n        res.appendHeader(name, value);\n      }\n    });\n    /**\n    * The response can't be directly piped to the underlying response. The\n    * following is duplicated from the edge runtime handler.\n    *\n    * See packages/next/server/next-server.ts\n    */\n    const originalResponse = res.originalResponse;\n    // A response body must not be sent for HEAD requests. See https://httpwg.org/specs/rfc9110.html#HEAD\n    if (response.body && req.method !== \"HEAD\") {\n      try {\n        await (0, _pipereadable.pipeToNodeResponse)(response.body, originalResponse);\n      } finally {\n        if (waitUntil) {\n          await waitUntil;\n        }\n      }\n    } else {\n      originalResponse.end();\n    }\n  }\n}","map":{"version":3,"names":["sendResponse","req","res","response","waitUntil","process","env","NEXT_RUNTIME","_response_headers","statusCode","status","statusMessage","statusText","headers","forEach","value","name","toLowerCase","cookie","_utils","splitCookiesString","appendHeader","originalResponse","body","method","_pipereadable","pipeToNodeResponse","end"],"sources":["../../src/server/send-response.ts"],"sourcesContent":[null],"mappings":";;;;;+BAasB;;;WAAAA,YAAA;;;8BAVa;uBACA;AAS5B,eAAeA,aACpBC,GAAoB,EACpBC,GAAqB,EACrBC,QAAkB,EAClBC,SAAwB;EAExB;EACA,IAAIC,OAAA,CAAQC,GAAG,CAACC,YAAY,KAAK,QAAQ;;IAKvC;IACAC,iBAAA;IALA;IACAN,GAAA,CAAIO,UAAU,GAAGN,QAAA,CAASO,MAAM;IAChCR,GAAA,CAAIS,aAAa,GAAGR,QAAA,CAASS,UAAU;KAGvCJ,iBAAA,GAAAL,QAAA,CAASU,OAAO,qBAAhBL,iBAAA,CAAkBM,OAAO,CAAC,CAACC,KAAA,EAAOC,IAAA;MAChC;MACA,IAAIA,IAAA,CAAKC,WAAW,OAAO,cAAc;QACvC;QACA,KAAK,MAAMC,MAAA,IAAU,IAAAC,MAAA,CAAAC,kBAAkB,EAACL,KAAA,GAAQ;UAC9Cb,GAAA,CAAImB,YAAY,CAACL,IAAA,EAAME,MAAA;QACzB;MACF,OAAO;QACLhB,GAAA,CAAImB,YAAY,CAACL,IAAA,EAAMD,KAAA;MACzB;IACF;IAEA;;;;;;IAOA,MAAMO,gBAAA,GAAmBpB,GAAC,CAAyBoB,gBAAgB;IAEnE;IACA,IAAInB,QAAA,CAASoB,IAAI,IAAItB,GAAA,CAAIuB,MAAM,KAAK,QAAQ;MAC1C,IAAI;QACF,MAAM,IAAAC,aAAA,CAAAC,kBAAkB,EAACvB,QAAA,CAASoB,IAAI,EAAED,gBAAA;MAC1C,UAAU;QACR,IAAIlB,SAAA,EAAW;UACb,MAAMA,SAAA;QACR;MACF;IACF,OAAO;MACLkB,gBAAA,CAAiBK,GAAG;IACtB;EACF;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}