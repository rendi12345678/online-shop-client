{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  getHash: null,\n  detectContentType: null,\n  ImageOptimizerCache: null,\n  ImageError: null,\n  getMaxAge: null,\n  optimizeImage: null,\n  imageOptimizer: null,\n  sendResponse: null,\n  getImageSize: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  getHash: function () {\n    return getHash;\n  },\n  detectContentType: function () {\n    return detectContentType;\n  },\n  ImageOptimizerCache: function () {\n    return ImageOptimizerCache;\n  },\n  ImageError: function () {\n    return ImageError;\n  },\n  getMaxAge: function () {\n    return getMaxAge;\n  },\n  optimizeImage: function () {\n    return optimizeImage;\n  },\n  imageOptimizer: function () {\n    return imageOptimizer;\n  },\n  sendResponse: function () {\n    return sendResponse;\n  },\n  getImageSize: function () {\n    return getImageSize;\n  }\n});\nconst _crypto = require(\"crypto\");\nconst _fs = require(\"fs\");\nconst _os = require(\"os\");\nconst _accept = require(\"next/dist/compiled/@hapi/accept\");\nconst _contentdisposition = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/content-disposition\"));\nconst _getorientation = require(\"next/dist/compiled/get-orientation\");\nconst _imagesize = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/image-size\"));\nconst _isanimated = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/is-animated\"));\nconst _path = require(\"path\");\nconst _url = /*#__PURE__*/_interop_require_default(require(\"url\"));\nconst _imageblursvg = require(\"../shared/lib/image-blur-svg\");\nconst _matchremotepattern = require(\"../shared/lib/match-remote-pattern\");\nconst _mockrequest = require(\"./lib/mock-request\");\nconst _sendpayload = require(\"./send-payload\");\nconst _servestatic = require(\"./serve-static\");\nconst _log = /*#__PURE__*/_interop_require_wildcard(require(\"../build/output/log\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function (nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\nfunction _interop_require_wildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n  var cache = _getRequireWildcardCache(nodeInterop);\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n  newObj.default = obj;\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n  return newObj;\n}\nconst AVIF = \"image/avif\";\nconst WEBP = \"image/webp\";\nconst PNG = \"image/png\";\nconst JPEG = \"image/jpeg\";\nconst GIF = \"image/gif\";\nconst SVG = \"image/svg+xml\";\nconst ICO = \"image/x-icon\";\nconst CACHE_VERSION = 3;\nconst ANIMATABLE_TYPES = [WEBP, PNG, GIF];\nconst VECTOR_TYPES = [SVG];\nconst BLUR_IMG_SIZE = 8 // should match `next-image-loader`\n;\n\nconst BLUR_QUALITY = 70 // should match `next-image-loader`\n;\n\nlet sharp;\ntry {\n  sharp = require(process.env.NEXT_SHARP_PATH || \"sharp\");\n  if (sharp && sharp.concurrency() > 1) {\n    // Reducing concurrency should reduce the memory usage too.\n    // We more aggressively reduce in dev but also reduce in prod.\n    // https://sharp.pixelplumbing.com/api-utility#concurrency\n    const divisor = process.env.NODE_ENV === \"development\" ? 4 : 2;\n    sharp.concurrency(Math.floor(Math.max((0, _os.cpus)().length / divisor, 1)));\n  }\n} catch (e) {\n  // Sharp not present on the server, Squoosh fallback will be used\n}\nlet showSharpMissingWarning = process.env.NODE_ENV === \"production\";\nfunction getSupportedMimeType(options, accept = \"\") {\n  const mimeType = (0, _accept.mediaType)(accept, options);\n  return accept.includes(mimeType) ? mimeType : \"\";\n}\nfunction getHash(items) {\n  const hash = (0, _crypto.createHash)(\"sha256\");\n  for (let item of items) {\n    if (typeof item === \"number\") hash.update(String(item));else {\n      hash.update(item);\n    }\n  }\n  // See https://en.wikipedia.org/wiki/Base64#Filenames\n  return hash.digest(\"base64\").replace(/\\//g, \"-\");\n}\nasync function writeToCacheDir(dir, extension, maxAge, expireAt, buffer, etag) {\n  const filename = (0, _path.join)(dir, `${maxAge}.${expireAt}.${etag}.${extension}`);\n  await _fs.promises.rm(dir, {\n    recursive: true,\n    force: true\n  }).catch(() => {});\n  await _fs.promises.mkdir(dir, {\n    recursive: true\n  });\n  await _fs.promises.writeFile(filename, buffer);\n}\nfunction detectContentType(buffer) {\n  if ([0xff, 0xd8, 0xff].every((b, i) => buffer[i] === b)) {\n    return JPEG;\n  }\n  if ([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a].every((b, i) => buffer[i] === b)) {\n    return PNG;\n  }\n  if ([0x47, 0x49, 0x46, 0x38].every((b, i) => buffer[i] === b)) {\n    return GIF;\n  }\n  if ([0x52, 0x49, 0x46, 0x46, 0, 0, 0, 0, 0x57, 0x45, 0x42, 0x50].every((b, i) => !b || buffer[i] === b)) {\n    return WEBP;\n  }\n  if ([0x3c, 0x3f, 0x78, 0x6d, 0x6c].every((b, i) => buffer[i] === b)) {\n    return SVG;\n  }\n  if ([0, 0, 0, 0, 0x66, 0x74, 0x79, 0x70, 0x61, 0x76, 0x69, 0x66].every((b, i) => !b || buffer[i] === b)) {\n    return AVIF;\n  }\n  if ([0x00, 0x00, 0x01, 0x00].every((b, i) => buffer[i] === b)) {\n    return ICO;\n  }\n  return null;\n}\nclass ImageOptimizerCache {\n  static validateParams(req, query, nextConfig, isDev) {\n    var _nextConfig_images;\n    const imageData = nextConfig.images;\n    const {\n      deviceSizes = [],\n      imageSizes = [],\n      domains = [],\n      minimumCacheTTL = 60,\n      formats = [\"image/webp\"]\n    } = imageData;\n    const remotePatterns = ((_nextConfig_images = nextConfig.images) == null ? void 0 : _nextConfig_images.remotePatterns) || [];\n    const {\n      url,\n      w,\n      q\n    } = query;\n    let href;\n    if (domains.length > 0) {\n      _log.warnOnce('The \"images.domains\" configuration is deprecated. Please use \"images.remotePatterns\" configuration instead.');\n    }\n    if (!url) {\n      return {\n        errorMessage: '\"url\" parameter is required'\n      };\n    } else if (Array.isArray(url)) {\n      return {\n        errorMessage: '\"url\" parameter cannot be an array'\n      };\n    }\n    let isAbsolute;\n    if (url.startsWith(\"/\")) {\n      href = url;\n      isAbsolute = false;\n    } else {\n      let hrefParsed;\n      try {\n        hrefParsed = new URL(url);\n        href = hrefParsed.toString();\n        isAbsolute = true;\n      } catch (_error) {\n        return {\n          errorMessage: '\"url\" parameter is invalid'\n        };\n      }\n      if (![\"http:\", \"https:\"].includes(hrefParsed.protocol)) {\n        return {\n          errorMessage: '\"url\" parameter is invalid'\n        };\n      }\n      if (!(0, _matchremotepattern.hasMatch)(domains, remotePatterns, hrefParsed)) {\n        return {\n          errorMessage: '\"url\" parameter is not allowed'\n        };\n      }\n    }\n    if (!w) {\n      return {\n        errorMessage: '\"w\" parameter (width) is required'\n      };\n    } else if (Array.isArray(w)) {\n      return {\n        errorMessage: '\"w\" parameter (width) cannot be an array'\n      };\n    }\n    if (!q) {\n      return {\n        errorMessage: '\"q\" parameter (quality) is required'\n      };\n    } else if (Array.isArray(q)) {\n      return {\n        errorMessage: '\"q\" parameter (quality) cannot be an array'\n      };\n    }\n    const width = parseInt(w, 10);\n    if (width <= 0 || isNaN(width)) {\n      return {\n        errorMessage: '\"w\" parameter (width) must be a number greater than 0'\n      };\n    }\n    const sizes = [...(deviceSizes || []), ...(imageSizes || [])];\n    if (isDev) {\n      sizes.push(BLUR_IMG_SIZE);\n    }\n    const isValidSize = sizes.includes(width) || isDev && width <= BLUR_IMG_SIZE;\n    if (!isValidSize) {\n      return {\n        errorMessage: `\"w\" parameter (width) of ${width} is not allowed`\n      };\n    }\n    const quality = parseInt(q);\n    if (isNaN(quality) || quality < 1 || quality > 100) {\n      return {\n        errorMessage: '\"q\" parameter (quality) must be a number between 1 and 100'\n      };\n    }\n    const mimeType = getSupportedMimeType(formats || [], req.headers[\"accept\"]);\n    const isStatic = url.startsWith(`${nextConfig.basePath || \"\"}/_next/static/media`);\n    return {\n      href,\n      sizes,\n      isAbsolute,\n      isStatic,\n      width,\n      quality,\n      mimeType,\n      minimumCacheTTL\n    };\n  }\n  static getCacheKey({\n    href,\n    width,\n    quality,\n    mimeType\n  }) {\n    return getHash([CACHE_VERSION, href, width, quality, mimeType]);\n  }\n  constructor({\n    distDir,\n    nextConfig\n  }) {\n    this.cacheDir = (0, _path.join)(distDir, \"cache\", \"images\");\n    this.nextConfig = nextConfig;\n  }\n  async get(cacheKey) {\n    try {\n      const cacheDir = (0, _path.join)(this.cacheDir, cacheKey);\n      const files = await _fs.promises.readdir(cacheDir);\n      const now = Date.now();\n      for (const file of files) {\n        const [maxAgeSt, expireAtSt, etag, extension] = file.split(\".\", 4);\n        const buffer = await _fs.promises.readFile((0, _path.join)(cacheDir, file));\n        const expireAt = Number(expireAtSt);\n        const maxAge = Number(maxAgeSt);\n        return {\n          value: {\n            kind: \"IMAGE\",\n            etag,\n            buffer,\n            extension\n          },\n          revalidateAfter: Math.max(maxAge, this.nextConfig.images.minimumCacheTTL) * 1000 + Date.now(),\n          curRevalidate: maxAge,\n          isStale: now > expireAt\n        };\n      }\n    } catch (_) {\n      // failed to read from cache dir, treat as cache miss\n    }\n    return null;\n  }\n  async set(cacheKey, value, {\n    revalidate\n  }) {\n    if ((value == null ? void 0 : value.kind) !== \"IMAGE\") {\n      throw new Error(\"invariant attempted to set non-image to image-cache\");\n    }\n    if (typeof revalidate !== \"number\") {\n      throw new Error(\"invariant revalidate must be a number for image-cache\");\n    }\n    const expireAt = Math.max(revalidate, this.nextConfig.images.minimumCacheTTL) * 1000 + Date.now();\n    try {\n      await writeToCacheDir((0, _path.join)(this.cacheDir, cacheKey), value.extension, revalidate, expireAt, value.buffer, value.etag);\n    } catch (err) {\n      _log.error(`Failed to write image to cache ${cacheKey}`, err);\n    }\n  }\n}\nclass ImageError extends Error {\n  constructor(statusCode, message) {\n    super(message);\n    // ensure an error status is used > 400\n    if (statusCode >= 400) {\n      this.statusCode = statusCode;\n    } else {\n      this.statusCode = 500;\n    }\n  }\n}\nfunction parseCacheControl(str) {\n  const map = new Map();\n  if (!str) {\n    return map;\n  }\n  for (let directive of str.split(\",\")) {\n    let [key, value] = directive.trim().split(\"=\", 2);\n    key = key.toLowerCase();\n    if (value) {\n      value = value.toLowerCase();\n    }\n    map.set(key, value);\n  }\n  return map;\n}\nfunction getMaxAge(str) {\n  const map = parseCacheControl(str);\n  if (map) {\n    let age = map.get(\"s-maxage\") || map.get(\"max-age\") || \"\";\n    if (age.startsWith('\"') && age.endsWith('\"')) {\n      age = age.slice(1, -1);\n    }\n    const n = parseInt(age, 10);\n    if (!isNaN(n)) {\n      return n;\n    }\n  }\n  return 0;\n}\nasync function optimizeImage({\n  buffer,\n  contentType,\n  quality,\n  width,\n  height,\n  nextConfigOutput\n}) {\n  let optimizedBuffer = buffer;\n  if (sharp) {\n    // Begin sharp transformation logic\n    const transformer = sharp(buffer, {\n      sequentialRead: true\n    });\n    transformer.rotate();\n    if (height) {\n      transformer.resize(width, height);\n    } else {\n      transformer.resize(width, undefined, {\n        withoutEnlargement: true\n      });\n    }\n    if (contentType === AVIF) {\n      if (transformer.avif) {\n        const avifQuality = quality - 15;\n        transformer.avif({\n          quality: Math.max(avifQuality, 0),\n          chromaSubsampling: \"4:2:0\"\n        });\n      } else {\n        _log.warnOnce(`Your installed version of the 'sharp' package does not support AVIF images. Run 'npm i sharp@latest' to upgrade to the latest version.\\n` + \"Read more: https://nextjs.org/docs/messages/sharp-version-avif\");\n        transformer.webp({\n          quality\n        });\n      }\n    } else if (contentType === WEBP) {\n      transformer.webp({\n        quality\n      });\n    } else if (contentType === PNG) {\n      transformer.png({\n        quality\n      });\n    } else if (contentType === JPEG) {\n      transformer.jpeg({\n        quality,\n        progressive: true\n      });\n    }\n    optimizedBuffer = await transformer.toBuffer();\n    // End sharp transformation logic\n  } else {\n    if (showSharpMissingWarning && nextConfigOutput === \"standalone\") {\n      _log.error(`Error: 'sharp' is required to be installed in standalone mode for the image optimization to function correctly. Read more at: https://nextjs.org/docs/messages/sharp-missing-in-production`);\n      throw new ImageError(500, \"Internal Server Error\");\n    }\n    // Show sharp warning in production once\n    if (showSharpMissingWarning) {\n      _log.warnOnce(`For production Image Optimization with Next.js, the optional 'sharp' package is strongly recommended. Run 'npm i sharp', and Next.js will use it automatically for Image Optimization.\\n` + \"Read more: https://nextjs.org/docs/messages/sharp-missing-in-production\");\n      showSharpMissingWarning = false;\n    }\n    // Begin Squoosh transformation logic\n    const orientation = await (0, _getorientation.getOrientation)(buffer);\n    const operations = [];\n    if (orientation === _getorientation.Orientation.RIGHT_TOP) {\n      operations.push({\n        type: \"rotate\",\n        numRotations: 1\n      });\n    } else if (orientation === _getorientation.Orientation.BOTTOM_RIGHT) {\n      operations.push({\n        type: \"rotate\",\n        numRotations: 2\n      });\n    } else if (orientation === _getorientation.Orientation.LEFT_BOTTOM) {\n      operations.push({\n        type: \"rotate\",\n        numRotations: 3\n      });\n    } else {\n      // TODO: support more orientations\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      // const _: never = orientation\n    }\n    if (height) {\n      operations.push({\n        type: \"resize\",\n        width,\n        height\n      });\n    } else {\n      operations.push({\n        type: \"resize\",\n        width\n      });\n    }\n    const {\n      processBuffer\n    } = require(\"./lib/squoosh/main\");\n    if (contentType === AVIF) {\n      optimizedBuffer = await processBuffer(buffer, operations, \"avif\", quality);\n    } else if (contentType === WEBP) {\n      optimizedBuffer = await processBuffer(buffer, operations, \"webp\", quality);\n    } else if (contentType === PNG) {\n      optimizedBuffer = await processBuffer(buffer, operations, \"png\", quality);\n    } else if (contentType === JPEG) {\n      optimizedBuffer = await processBuffer(buffer, operations, \"jpeg\", quality);\n    }\n  }\n  return optimizedBuffer;\n}\nasync function imageOptimizer(_req, _res, paramsResult, nextConfig, isDev, handleRequest) {\n  let upstreamBuffer;\n  let upstreamType;\n  let maxAge;\n  const {\n    isAbsolute,\n    href,\n    width,\n    mimeType,\n    quality\n  } = paramsResult;\n  if (isAbsolute) {\n    const upstreamRes = await fetch(href);\n    if (!upstreamRes.ok) {\n      _log.error(\"upstream image response failed for\", href, upstreamRes.status);\n      throw new ImageError(upstreamRes.status, '\"url\" parameter is valid but upstream response is invalid');\n    }\n    upstreamBuffer = Buffer.from(await upstreamRes.arrayBuffer());\n    upstreamType = detectContentType(upstreamBuffer) || upstreamRes.headers.get(\"Content-Type\");\n    maxAge = getMaxAge(upstreamRes.headers.get(\"Cache-Control\"));\n  } else {\n    try {\n      const mocked = (0, _mockrequest.createRequestResponseMocks)({\n        url: href,\n        method: _req.method || \"GET\",\n        headers: _req.headers,\n        socket: _req.socket\n      });\n      await handleRequest(mocked.req, mocked.res, _url.default.parse(href, true));\n      await mocked.res.hasStreamed;\n      if (!mocked.res.statusCode) {\n        _log.error(\"image response failed for\", href, mocked.res.statusCode);\n        throw new ImageError(mocked.res.statusCode, '\"url\" parameter is valid but internal response is invalid');\n      }\n      upstreamBuffer = Buffer.concat(mocked.res.buffers);\n      upstreamType = detectContentType(upstreamBuffer) || mocked.res.getHeader(\"Content-Type\");\n      const cacheControl = mocked.res.getHeader(\"Cache-Control\");\n      maxAge = cacheControl ? getMaxAge(cacheControl) : 0;\n    } catch (err) {\n      _log.error(\"upstream image response failed for\", href, err);\n      throw new ImageError(500, '\"url\" parameter is valid but upstream response is invalid');\n    }\n  }\n  if (upstreamType) {\n    upstreamType = upstreamType.toLowerCase().trim();\n    if (upstreamType.startsWith(\"image/svg\") && !nextConfig.images.dangerouslyAllowSVG) {\n      _log.error(`The requested resource \"${href}\" has type \"${upstreamType}\" but dangerouslyAllowSVG is disabled`);\n      throw new ImageError(400, '\"url\" parameter is valid but image type is not allowed');\n    }\n    const vector = VECTOR_TYPES.includes(upstreamType);\n    const animate = ANIMATABLE_TYPES.includes(upstreamType) && (0, _isanimated.default)(upstreamBuffer);\n    if (vector || animate) {\n      return {\n        buffer: upstreamBuffer,\n        contentType: upstreamType,\n        maxAge\n      };\n    }\n    if (!upstreamType.startsWith(\"image/\") || upstreamType.includes(\",\")) {\n      _log.error(\"The requested resource isn't a valid image for\", href, \"received\", upstreamType);\n      throw new ImageError(400, \"The requested resource isn't a valid image.\");\n    }\n  }\n  let contentType;\n  if (mimeType) {\n    contentType = mimeType;\n  } else if ((upstreamType == null ? void 0 : upstreamType.startsWith(\"image/\")) && (0, _servestatic.getExtension)(upstreamType) && upstreamType !== WEBP && upstreamType !== AVIF) {\n    contentType = upstreamType;\n  } else {\n    contentType = JPEG;\n  }\n  try {\n    let optimizedBuffer = await optimizeImage({\n      buffer: upstreamBuffer,\n      contentType,\n      quality,\n      width,\n      nextConfigOutput: nextConfig.output\n    });\n    if (optimizedBuffer) {\n      if (isDev && width <= BLUR_IMG_SIZE && quality === BLUR_QUALITY) {\n        const {\n          getMetadata\n        } = require(\"./lib/squoosh/main\");\n        // During `next dev`, we don't want to generate blur placeholders with webpack\n        // because it can delay starting the dev server. Instead, `next-image-loader.js`\n        // will inline a special url to lazily generate the blur placeholder at request time.\n        const meta = await getMetadata(optimizedBuffer);\n        const opts = {\n          blurWidth: meta.width,\n          blurHeight: meta.height,\n          blurDataURL: `data:${contentType};base64,${optimizedBuffer.toString(\"base64\")}`\n        };\n        optimizedBuffer = Buffer.from(unescape((0, _imageblursvg.getImageBlurSvg)(opts)));\n        contentType = \"image/svg+xml\";\n      }\n      return {\n        buffer: optimizedBuffer,\n        contentType,\n        maxAge: Math.max(maxAge, nextConfig.images.minimumCacheTTL)\n      };\n    } else {\n      throw new ImageError(500, \"Unable to optimize buffer\");\n    }\n  } catch (error) {\n    if (upstreamBuffer && upstreamType) {\n      // If we fail to optimize, fallback to the original image\n      return {\n        buffer: upstreamBuffer,\n        contentType: upstreamType,\n        maxAge: nextConfig.images.minimumCacheTTL\n      };\n    } else {\n      throw new ImageError(400, \"Unable to optimize image and unable to fallback to upstream image\");\n    }\n  }\n}\nfunction getFileNameWithExtension(url, contentType) {\n  const [urlWithoutQueryParams] = url.split(\"?\", 1);\n  const fileNameWithExtension = urlWithoutQueryParams.split(\"/\").pop();\n  if (!contentType || !fileNameWithExtension) {\n    return \"image.bin\";\n  }\n  const [fileName] = fileNameWithExtension.split(\".\", 1);\n  const extension = (0, _servestatic.getExtension)(contentType);\n  return `${fileName}.${extension}`;\n}\nfunction setResponseHeaders(req, res, url, etag, contentType, isStatic, xCache, imagesConfig, maxAge, isDev) {\n  res.setHeader(\"Vary\", \"Accept\");\n  res.setHeader(\"Cache-Control\", isStatic ? \"public, max-age=315360000, immutable\" : `public, max-age=${isDev ? 0 : maxAge}, must-revalidate`);\n  if ((0, _sendpayload.sendEtagResponse)(req, res, etag)) {\n    // already called res.end() so we're finished\n    return {\n      finished: true\n    };\n  }\n  if (contentType) {\n    res.setHeader(\"Content-Type\", contentType);\n  }\n  const fileName = getFileNameWithExtension(url, contentType);\n  res.setHeader(\"Content-Disposition\", (0, _contentdisposition.default)(fileName, {\n    type: imagesConfig.contentDispositionType\n  }));\n  res.setHeader(\"Content-Security-Policy\", imagesConfig.contentSecurityPolicy);\n  res.setHeader(\"X-Nextjs-Cache\", xCache);\n  return {\n    finished: false\n  };\n}\nfunction sendResponse(req, res, url, extension, buffer, isStatic, xCache, imagesConfig, maxAge, isDev) {\n  const contentType = (0, _servestatic.getContentType)(extension);\n  const etag = getHash([buffer]);\n  const result = setResponseHeaders(req, res, url, etag, contentType, isStatic, xCache, imagesConfig, maxAge, isDev);\n  if (!result.finished) {\n    res.setHeader(\"Content-Length\", Buffer.byteLength(buffer));\n    res.end(buffer);\n  }\n}\nasync function getImageSize(buffer,\n// Should match VALID_BLUR_EXT\nextension) {\n  // TODO: upgrade \"image-size\" package to support AVIF\n  // See https://github.com/image-size/image-size/issues/348\n  if (extension === \"avif\") {\n    if (sharp) {\n      const transformer = sharp(buffer);\n      const {\n        width,\n        height\n      } = await transformer.metadata();\n      return {\n        width,\n        height\n      };\n    } else {\n      const {\n        decodeBuffer\n      } = require(\"./lib/squoosh/main\");\n      const {\n        width,\n        height\n      } = await decodeBuffer(buffer);\n      return {\n        width,\n        height\n      };\n    }\n  }\n  const {\n    width,\n    height\n  } = (0, _imagesize.default)(buffer);\n  return {\n    width,\n    height\n  };\n}","map":{"version":3,"names":["getHash","detectContentType","ImageOptimizerCache","ImageError","getMaxAge","optimizeImage","imageOptimizer","sendResponse","getImageSize","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","concurrency","divisor","NODE_ENV","Math","floor","max","_os","cpus","length","e","showSharpMissingWarning","getSupportedMimeType","options","accept","mimeType","_accept","mediaType","includes","items","hash","_crypto","createHash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","_path","join","_fs","promises","rm","recursive","force","catch","mkdir","writeFile","every","b","i","validateParams","req","query","nextConfig","isDev","_nextConfig_images","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","_log","warnOnce","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","_matchremotepattern","hasMatch","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","curRevalidate","isStale","_","set","revalidate","Error","err","error","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","age","endsWith","slice","n","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","webp","png","jpeg","progressive","toBuffer","orientation","_getorientation","getOrientation","operations","Orientation","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","processBuffer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","_mockrequest","createRequestResponseMocks","method","socket","res","_url","default","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","_isanimated","_servestatic","getExtension","output","getMetadata","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","_imageblursvg","getImageBlurSvg","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","_sendpayload","sendEtagResponse","finished","_contentdisposition","contentDispositionType","contentSecurityPolicy","getContentType","result","byteLength","end","metadata","decodeBuffer","_imagesize"],"sources":["../../src/server/image-optimizer.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}