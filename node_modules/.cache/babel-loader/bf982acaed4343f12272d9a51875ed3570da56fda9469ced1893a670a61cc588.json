{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  getMaybePagePath: null,\n  getPagePath: null,\n  requirePage: null,\n  requireFontManifest: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  getMaybePagePath: function () {\n    return getMaybePagePath;\n  },\n  getPagePath: function () {\n    return getPagePath;\n  },\n  requirePage: function () {\n    return requirePage;\n  },\n  requireFontManifest: function () {\n    return requireFontManifest;\n  }\n});\nconst _path = /*#__PURE__*/_interop_require_default(require(\"path\"));\nconst _constants = require(\"../shared/lib/constants\");\nconst _normalizelocalepath = require(\"../shared/lib/i18n/normalize-locale-path\");\nconst _normalizepagepath = require(\"../shared/lib/page-path/normalize-page-path\");\nconst _denormalizepagepath = require(\"../shared/lib/page-path/denormalize-page-path\");\nconst _utils = require(\"../shared/lib/utils\");\nconst _lrucache = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/lru-cache\"));\nconst _loadmanifest = require(\"./load-manifest\");\nconst _fs = require(\"fs\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst isDev = process.env.NODE_ENV === \"development\";\nconst pagePathCache = !isDev ? new _lrucache.default({\n  max: 1000\n}) : null;\nfunction getMaybePagePath(page, distDir, locales, isAppPath) {\n  const cacheKey = `${page}:${distDir}:${locales}:${isAppPath}`;\n  let pagePath = pagePathCache == null ? void 0 : pagePathCache.get(cacheKey);\n  // If we have a cached path, we can return it directly.\n  if (pagePath) return pagePath;\n  const serverBuildPath = _path.default.join(distDir, _constants.SERVER_DIRECTORY);\n  let appPathsManifest;\n  if (isAppPath) {\n    appPathsManifest = (0, _loadmanifest.loadManifest)(_path.default.join(serverBuildPath, _constants.APP_PATHS_MANIFEST), !isDev);\n  }\n  const pagesManifest = (0, _loadmanifest.loadManifest)(_path.default.join(serverBuildPath, _constants.PAGES_MANIFEST), !isDev);\n  try {\n    page = (0, _denormalizepagepath.denormalizePagePath)((0, _normalizepagepath.normalizePagePath)(page));\n  } catch (err) {\n    console.error(err);\n    throw new _utils.PageNotFoundError(page);\n  }\n  const checkManifest = manifest => {\n    let curPath = manifest[page];\n    if (!manifest[curPath] && locales) {\n      const manifestNoLocales = {};\n      for (const key of Object.keys(manifest)) {\n        manifestNoLocales[(0, _normalizelocalepath.normalizeLocalePath)(key, locales).pathname] = pagesManifest[key];\n      }\n      curPath = manifestNoLocales[page];\n    }\n    return curPath;\n  };\n  if (appPathsManifest) {\n    pagePath = checkManifest(appPathsManifest);\n  }\n  if (!pagePath) {\n    pagePath = checkManifest(pagesManifest);\n  }\n  if (!pagePath) {\n    pagePathCache == null ? void 0 : pagePathCache.set(cacheKey, null);\n    return null;\n  }\n  pagePath = _path.default.join(serverBuildPath, pagePath);\n  pagePathCache == null ? void 0 : pagePathCache.set(cacheKey, pagePath);\n  return pagePath;\n}\nfunction getPagePath(page, distDir, locales, isAppPath) {\n  const pagePath = getMaybePagePath(page, distDir, locales, isAppPath);\n  if (!pagePath) {\n    throw new _utils.PageNotFoundError(page);\n  }\n  return pagePath;\n}\nfunction requirePage(page, distDir, isAppPath) {\n  const pagePath = getPagePath(page, distDir, undefined, isAppPath);\n  if (pagePath.endsWith(\".html\")) {\n    return _fs.promises.readFile(pagePath, \"utf8\").catch(err => {\n      throw new _utils.MissingStaticPage(page, err.message);\n    });\n  }\n  // since require is synchronous we can set the specific runtime\n  // we are requiring for the require-hook and then clear after\n  try {\n    process.env.__NEXT_PRIVATE_RUNTIME_TYPE = isAppPath ? \"app\" : \"pages\";\n    const mod = process.env.NEXT_MINIMAL ? __non_webpack_require__(pagePath) : require(pagePath);\n    return mod;\n  } finally {\n    process.env.__NEXT_PRIVATE_RUNTIME_TYPE = \"\";\n  }\n}\nfunction requireFontManifest(distDir) {\n  const serverBuildPath = _path.default.join(distDir, _constants.SERVER_DIRECTORY);\n  const fontManifest = (0, _loadmanifest.loadManifest)(_path.default.join(serverBuildPath, _constants.FONT_MANIFEST));\n  return fontManifest;\n}","map":{"version":3,"names":["getMaybePagePath","getPagePath","requirePage","requireFontManifest","isDev","process","env","NODE_ENV","pagePathCache","_lrucache","default","max","page","distDir","locales","isAppPath","cacheKey","pagePath","get","serverBuildPath","_path","join","_constants","SERVER_DIRECTORY","appPathsManifest","_loadmanifest","loadManifest","APP_PATHS_MANIFEST","pagesManifest","PAGES_MANIFEST","_denormalizepagepath","denormalizePagePath","_normalizepagepath","normalizePagePath","err","console","error","_utils","PageNotFoundError","checkManifest","manifest","curPath","manifestNoLocales","key","Object","keys","_normalizelocalepath","normalizeLocalePath","pathname","set","undefined","endsWith","_fs","promises","readFile","catch","MissingStaticPage","message","__NEXT_PRIVATE_RUNTIME_TYPE","mod","NEXT_MINIMAL","__non_webpack_require__","require","fontManifest","FONT_MANIFEST"],"sources":["../../src/server/require.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}