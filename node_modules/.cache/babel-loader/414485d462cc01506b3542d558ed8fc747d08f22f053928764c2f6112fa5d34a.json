{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"default\", {\n  enumerable: true,\n  get: function () {\n    return _default;\n  }\n});\nconst _path = /*#__PURE__*/_interop_require_default(require(\"path\"));\nconst _fs = /*#__PURE__*/_interop_require_default(require(\"fs\"));\nconst _constant = require(\"../constant\");\nconst _utils = require(\"../utils\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst entry = {\n  // Give auto completion for the component's props\n  getCompletionsAtPosition(fileName, node, position) {\n    var _node_parameters;\n    const ts = (0, _utils.getTs)();\n    const entries = [];\n    // Default export function might not accept parameters\n    const paramNode = (_node_parameters = node.parameters) == null ? void 0 : _node_parameters[0];\n    if (paramNode && (0, _utils.isPositionInsideNode)(position, paramNode)) {\n      const props = paramNode == null ? void 0 : paramNode.name;\n      if (props && ts.isObjectBindingPattern(props)) {\n        let validProps = [];\n        let validPropsWithType = [];\n        let type;\n        if ((0, _utils.isPageFile)(fileName)) {\n          // For page entries (page.js), it can only have `params` and `searchParams`\n          // as the prop names.\n          validProps = _constant.ALLOWED_PAGE_PROPS;\n          validPropsWithType = _constant.ALLOWED_PAGE_PROPS;\n          type = \"page\";\n        } else {\n          // For layout entires, check if it has any named slots.\n          const currentDir = _path.default.dirname(fileName);\n          const items = _fs.default.readdirSync(currentDir, {\n            withFileTypes: true\n          });\n          const slots = [];\n          for (const item of items) {\n            if (item.isDirectory() && item.name.startsWith(\"@\")) {\n              slots.push(item.name.slice(1));\n            }\n          }\n          validProps = _constant.ALLOWED_LAYOUT_PROPS.concat(slots);\n          validPropsWithType = _constant.ALLOWED_LAYOUT_PROPS.concat(slots.map(s => `${s}: React.ReactNode`));\n          type = \"layout\";\n        }\n        // Auto completion for props\n        for (const element of props.elements) {\n          if ((0, _utils.isPositionInsideNode)(position, element)) {\n            const nameNode = element.propertyName || element.name;\n            if ((0, _utils.isPositionInsideNode)(position, nameNode)) {\n              for (const name of validProps) {\n                entries.push({\n                  name,\n                  insertText: name,\n                  sortText: \"_\" + name,\n                  kind: ts.ScriptElementKind.memberVariableElement,\n                  kindModifiers: ts.ScriptElementKindModifier.none,\n                  labelDetails: {\n                    description: `Next.js ${type} prop`\n                  }\n                });\n              }\n            }\n            break;\n          }\n        }\n        // Auto completion for types\n        if (paramNode.type && ts.isTypeLiteralNode(paramNode.type)) {\n          for (const member of paramNode.type.members) {\n            if ((0, _utils.isPositionInsideNode)(position, member)) {\n              for (const name of validPropsWithType) {\n                entries.push({\n                  name,\n                  insertText: name,\n                  sortText: \"_\" + name,\n                  kind: ts.ScriptElementKind.memberVariableElement,\n                  kindModifiers: ts.ScriptElementKindModifier.none,\n                  labelDetails: {\n                    description: `Next.js ${type} prop type`\n                  }\n                });\n              }\n              break;\n            }\n          }\n        }\n      }\n    }\n    return entries;\n  },\n  // Give error diagnostics for the component\n  getSemanticDiagnostics(fileName, source, node) {\n    var _node_parameters_, _node_parameters;\n    const ts = (0, _utils.getTs)();\n    let validProps = [];\n    let type;\n    if ((0, _utils.isPageFile)(fileName)) {\n      // For page entries (page.js), it can only have `params` and `searchParams`\n      // as the prop names.\n      validProps = _constant.ALLOWED_PAGE_PROPS;\n      type = \"page\";\n    } else {\n      // For layout entires, check if it has any named slots.\n      const currentDir = _path.default.dirname(fileName);\n      const items = _fs.default.readdirSync(currentDir, {\n        withFileTypes: true\n      });\n      const slots = [];\n      for (const item of items) {\n        if (item.isDirectory() && item.name.startsWith(\"@\")) {\n          slots.push(item.name.slice(1));\n        }\n      }\n      validProps = _constant.ALLOWED_LAYOUT_PROPS.concat(slots);\n      type = \"layout\";\n    }\n    const diagnostics = [];\n    const props = (_node_parameters = node.parameters) == null ? void 0 : (_node_parameters_ = _node_parameters[0]) == null ? void 0 : _node_parameters_.name;\n    if (props && ts.isObjectBindingPattern(props)) {\n      for (const prop of props.elements) {\n        const propName = (prop.propertyName || prop.name).getText();\n        if (!validProps.includes(propName)) {\n          diagnostics.push({\n            file: source,\n            category: ts.DiagnosticCategory.Error,\n            code: _constant.NEXT_TS_ERRORS.INVALID_PAGE_PROP,\n            messageText: `\"${propName}\" is not a valid ${type} prop.`,\n            start: prop.getStart(),\n            length: prop.getWidth()\n          });\n        }\n      }\n    }\n    return diagnostics;\n  }\n};\nconst _default = entry;","map":{"version":3,"names":["_default","entry","getCompletionsAtPosition","fileName","node","position","_node_parameters","ts","_utils","getTs","entries","paramNode","parameters","isPositionInsideNode","props","name","isObjectBindingPattern","validProps","validPropsWithType","type","isPageFile","_constant","ALLOWED_PAGE_PROPS","currentDir","_path","default","dirname","items","_fs","readdirSync","withFileTypes","slots","item","isDirectory","startsWith","push","slice","ALLOWED_LAYOUT_PROPS","concat","map","s","element","elements","nameNode","propertyName","insertText","sortText","kind","ScriptElementKind","memberVariableElement","kindModifiers","ScriptElementKindModifier","none","labelDetails","description","isTypeLiteralNode","member","members","getSemanticDiagnostics","source","_node_parameters_","diagnostics","prop","propName","getText","includes","file","category","DiagnosticCategory","Error","code","NEXT_TS_ERRORS","INVALID_PAGE_PROP","messageText","start","getStart","length","getWidth"],"sources":["../../../../src/server/typescript/rules/entry.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}