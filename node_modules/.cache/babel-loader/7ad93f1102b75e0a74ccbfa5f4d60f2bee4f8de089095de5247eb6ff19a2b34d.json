{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"store\", {\n  enumerable: true,\n  get: function () {\n    return store;\n  }\n});\nconst _unistore = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/unistore\"));\nconst _stripansi = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/strip-ansi\"));\nconst _trace = require(\"../../trace\");\nconst _swc = require(\"../swc\");\nconst _log = /*#__PURE__*/_interop_require_wildcard(require(\"./log\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function (nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\nfunction _interop_require_wildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n  var cache = _getRequireWildcardCache(nodeInterop);\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n  newObj.default = obj;\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n  return newObj;\n}\nconst MAX_LOG_SKIP_DURATION = 500 // 500ms\n;\n\nconst store = (0, _unistore.default)({\n  appUrl: null,\n  bindAddr: null,\n  bootstrap: true\n});\nlet lastStore = {\n  appUrl: null,\n  bindAddr: null,\n  bootstrap: true\n};\nfunction hasStoreChanged(nextStore) {\n  if ([...new Set([...Object.keys(lastStore), ...Object.keys(nextStore)])].every(key => Object.is(lastStore[key], nextStore[key]))) {\n    return false;\n  }\n  lastStore = nextStore;\n  return true;\n}\nlet startTime = 0;\nlet trigger = \"\" // default, use empty string for trigger\n;\n\nlet loadingLogTimer = null;\nstore.subscribe(state => {\n  if (!hasStoreChanged(state)) {\n    return;\n  }\n  if (state.bootstrap) {\n    return;\n  }\n  if (state.loading) {\n    if (state.trigger) {\n      trigger = state.trigger;\n      if (trigger !== \"initial\") {\n        if (!loadingLogTimer) {\n          // Only log compiling if compiled is not finished in 3 seconds\n          loadingLogTimer = setTimeout(() => {\n            _log.wait(`Compiling ${trigger} ...`);\n          }, MAX_LOG_SKIP_DURATION);\n        }\n      }\n    }\n    if (startTime === 0) {\n      startTime = Date.now();\n    }\n    return;\n  }\n  if (state.errors) {\n    _log.error(state.errors[0]);\n    const cleanError = (0, _stripansi.default)(state.errors[0]);\n    if (cleanError.indexOf(\"SyntaxError\") > -1) {\n      const matches = cleanError.match(/\\[.*\\]=/);\n      if (matches) {\n        for (const match of matches) {\n          const prop = (match.split(\"]\").shift() || \"\").slice(1);\n          console.log(`AMP bind syntax [${prop}]='' is not supported in JSX, use 'data-amp-bind-${prop}' instead. https://nextjs.org/docs/messages/amp-bind-jsx-alt`);\n        }\n        return;\n      }\n    }\n    startTime = 0;\n    // Ensure traces are flushed after each compile in development mode\n    (0, _trace.flushAllTraces)();\n    (0, _swc.teardownTraceSubscriber)();\n    (0, _swc.teardownHeapProfiler)();\n    (0, _swc.teardownCrashReporter)();\n    return;\n  }\n  let timeMessage = \"\";\n  if (startTime) {\n    const time = Date.now() - startTime;\n    startTime = 0;\n    timeMessage = \" \" + (time > 2000 ? `in ${Math.round(time / 100) / 10}s` : `in ${time}ms`);\n  }\n  let modulesMessage = \"\";\n  if (state.totalModulesCount) {\n    modulesMessage = ` (${state.totalModulesCount} modules)`;\n  }\n  if (state.warnings) {\n    _log.warn(state.warnings.join(\"\\n\\n\"));\n    // Ensure traces are flushed after each compile in development mode\n    (0, _trace.flushAllTraces)();\n    (0, _swc.teardownTraceSubscriber)();\n    (0, _swc.teardownHeapProfiler)();\n    (0, _swc.teardownCrashReporter)();\n    return;\n  }\n  if (state.typeChecking) {\n    _log.info(`bundled ${trigger}${timeMessage}${modulesMessage}, type checking...`);\n    return;\n  }\n  if (trigger === \"initial\") {\n    trigger = \"\";\n  } else {\n    if (loadingLogTimer) {\n      clearTimeout(loadingLogTimer);\n      loadingLogTimer = null;\n    }\n    _log.event(`Compiled${trigger ? \" \" + trigger : \"\"}${timeMessage}${modulesMessage}`);\n    trigger = \"\";\n  }\n  // Ensure traces are flushed after each compile in development mode\n  (0, _trace.flushAllTraces)();\n  (0, _swc.teardownTraceSubscriber)();\n  (0, _swc.teardownHeapProfiler)();\n  (0, _swc.teardownCrashReporter)();\n});","map":{"version":3,"names":["store","MAX_LOG_SKIP_DURATION","_unistore","default","appUrl","bindAddr","bootstrap","lastStore","hasStoreChanged","nextStore","Set","Object","keys","every","key","is","startTime","trigger","loadingLogTimer","subscribe","state","loading","setTimeout","_log","wait","Date","now","errors","error","cleanError","_stripansi","indexOf","matches","match","prop","split","shift","slice","console","log","_trace","flushAllTraces","_swc","teardownTraceSubscriber","teardownHeapProfiler","teardownCrashReporter","timeMessage","time","Math","round","modulesMessage","totalModulesCount","warnings","warn","join","typeChecking","info","clearTimeout","event"],"sources":["../../../src/build/output/store.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}