{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"default\", {\n  enumerable: true,\n  get: function () {\n    return _default;\n  }\n});\nconst _constant = require(\"../constant\");\nconst _utils = require(\"../utils\");\nconst serverLayer = {\n  // On the server layer we need to filter out some invalid completion results.\n  filterCompletionsAtPosition(entries) {\n    return entries.filter(e => {\n      // Remove disallowed React APIs.\n      if (_constant.DISALLOWED_SERVER_REACT_APIS.includes(e.name) && e.source === \"react\") {\n        return false;\n      }\n      return true;\n    });\n  },\n  // Filter out quick info for some React APIs.\n  hasDisallowedReactAPIDefinition(definitions) {\n    return definitions == null ? void 0 : definitions.some(d => _constant.DISALLOWED_SERVER_REACT_APIS.includes(d.name) && d.containerName === \"React\");\n  },\n  // Give errors about disallowed imports such as `useState`.\n  getSemanticDiagnosticsForImportDeclaration(source, node) {\n    const ts = (0, _utils.getTs)();\n    const diagnostics = [];\n    const importPath = node.moduleSpecifier.getText(source);\n    if (importPath === \"'react'\" || importPath === '\"react\"') {\n      // Check if it imports \"useState\"\n      const importClause = node.importClause;\n      if (importClause) {\n        const namedBindings = importClause.namedBindings;\n        if (namedBindings && ts.isNamedImports(namedBindings)) {\n          const elements = namedBindings.elements;\n          for (const element of elements) {\n            const name = element.name.getText(source);\n            if (_constant.DISALLOWED_SERVER_REACT_APIS.includes(name)) {\n              diagnostics.push({\n                file: source,\n                category: ts.DiagnosticCategory.Error,\n                code: _constant.NEXT_TS_ERRORS.INVALID_SERVER_API,\n                messageText: `\"${name}\" is not allowed in Server Components.`,\n                start: element.name.getStart(),\n                length: element.name.getWidth()\n              });\n            }\n          }\n        }\n      }\n    }\n    return diagnostics;\n  }\n};\nconst _default = serverLayer;","map":{"version":3,"names":["_default","serverLayer","filterCompletionsAtPosition","entries","filter","e","_constant","DISALLOWED_SERVER_REACT_APIS","includes","name","source","hasDisallowedReactAPIDefinition","definitions","some","d","containerName","getSemanticDiagnosticsForImportDeclaration","node","ts","_utils","getTs","diagnostics","importPath","moduleSpecifier","getText","importClause","namedBindings","isNamedImports","elements","element","push","file","category","DiagnosticCategory","Error","code","NEXT_TS_ERRORS","INVALID_SERVER_API","messageText","start","getStart","length","getWidth"],"sources":["../../../../src/server/typescript/rules/server.ts"],"sourcesContent":[null],"mappings":";;;;;+BAoEA;;;WAAAA,QAAA;;;0BApE6D;uBACvC;AAGtB,MAAMC,WAAA,GAAc;EAClB;EACAC,4BAA4BC,OAAmC;IAC7D,OAAOA,OAAA,CAAQC,MAAM,CAAEC,CAAA;MACrB;MACA,IACEC,SAAA,CAAAC,4BAA4B,CAACC,QAAQ,CAACH,CAAA,CAAEI,IAAI,KAC5CJ,CAAA,CAAEK,MAAM,KAAK,SACb;QACA,OAAO;MACT;MACA,OAAO;IACT;EACF;EAEA;EACAC,gCACEC,WAA+C;IAE/C,OAAOA,WAAA,oBAAAA,WAAA,CAAaC,IAAI,CACrBC,CAAA,IACCR,SAAA,CAAAC,4BAA4B,CAACC,QAAQ,CAACM,CAAA,CAAEL,IAAI,KAC5CK,CAAA,CAAEC,aAAa,KAAK;EAE1B;EAEA;EACAC,2CACEN,MAA2B,EAC3BO,IAAgC;IAEhC,MAAMC,EAAA,GAAK,IAAAC,MAAA,CAAAC,KAAK;IAEhB,MAAMC,WAAA,GAAqC,EAAE;IAE7C,MAAMC,UAAA,GAAaL,IAAA,CAAKM,eAAe,CAACC,OAAO,CAACd,MAAA;IAChD,IAAIY,UAAA,KAAe,aAAaA,UAAA,KAAe,WAAW;MACxD;MACA,MAAMG,YAAA,GAAeR,IAAA,CAAKQ,YAAY;MACtC,IAAIA,YAAA,EAAc;QAChB,MAAMC,aAAA,GAAgBD,YAAA,CAAaC,aAAa;QAChD,IAAIA,aAAA,IAAiBR,EAAA,CAAGS,cAAc,CAACD,aAAA,GAAgB;UACrD,MAAME,QAAA,GAAWF,aAAA,CAAcE,QAAQ;UACvC,KAAK,MAAMC,OAAA,IAAWD,QAAA,EAAU;YAC9B,MAAMnB,IAAA,GAAOoB,OAAA,CAAQpB,IAAI,CAACe,OAAO,CAACd,MAAA;YAClC,IAAIJ,SAAA,CAAAC,4BAA4B,CAACC,QAAQ,CAACC,IAAA,GAAO;cAC/CY,WAAA,CAAYS,IAAI,CAAC;gBACfC,IAAA,EAAMrB,MAAA;gBACNsB,QAAA,EAAUd,EAAA,CAAGe,kBAAkB,CAACC,KAAK;gBACrCC,IAAA,EAAM7B,SAAA,CAAA8B,cAAc,CAACC,kBAAkB;gBACvCC,WAAA,EAAc,IAAG7B,IAAK,wCAAuC;gBAC7D8B,KAAA,EAAOV,OAAA,CAAQpB,IAAI,CAAC+B,QAAQ;gBAC5BC,MAAA,EAAQZ,OAAA,CAAQpB,IAAI,CAACiC,QAAQ;cAC/B;YACF;UACF;QACF;MACF;IACF;IAEA,OAAOrB,WAAA;EACT;AACF;MAEArB,QAAA,GAAeC,WAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}