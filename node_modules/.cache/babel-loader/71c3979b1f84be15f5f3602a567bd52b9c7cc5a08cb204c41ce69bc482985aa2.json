{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  log: null,\n  init: null,\n  getTs: null,\n  getInfo: null,\n  getTypeChecker: null,\n  getSource: null,\n  removeStringQuotes: null,\n  isPositionInsideNode: null,\n  isDefaultFunctionExport: null,\n  isInsideApp: null,\n  isAppEntryFile: null,\n  isPageFile: null,\n  getIsClientEntry: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  log: function () {\n    return log;\n  },\n  init: function () {\n    return init;\n  },\n  getTs: function () {\n    return getTs;\n  },\n  getInfo: function () {\n    return getInfo;\n  },\n  getTypeChecker: function () {\n    return getTypeChecker;\n  },\n  getSource: function () {\n    return getSource;\n  },\n  removeStringQuotes: function () {\n    return removeStringQuotes;\n  },\n  isPositionInsideNode: function () {\n    return isPositionInsideNode;\n  },\n  isDefaultFunctionExport: function () {\n    return isDefaultFunctionExport;\n  },\n  isInsideApp: function () {\n    return isInsideApp;\n  },\n  isAppEntryFile: function () {\n    return isAppEntryFile;\n  },\n  isPageFile: function () {\n    return isPageFile;\n  },\n  getIsClientEntry: function () {\n    return getIsClientEntry;\n  }\n});\nconst _path = /*#__PURE__*/_interop_require_default(require(\"path\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nlet ts;\nlet info;\nlet appDirRegExp;\nfunction log(message) {\n  info.project.projectService.logger.info(message);\n}\nfunction init(opts) {\n  ts = opts.ts;\n  info = opts.info;\n  const projectDir = info.project.getCurrentDirectory();\n  appDirRegExp = new RegExp(\"^\" + (projectDir + \"(/src)?/app\").replace(/[\\\\/]/g, \"[\\\\/]\"));\n  log(\"Starting Next.js TypeScript plugin: \" + projectDir);\n}\nfunction getTs() {\n  return ts;\n}\nfunction getInfo() {\n  return info;\n}\nfunction getTypeChecker() {\n  var _info_languageService_getProgram;\n  return (_info_languageService_getProgram = info.languageService.getProgram()) == null ? void 0 : _info_languageService_getProgram.getTypeChecker();\n}\nfunction getSource(fileName) {\n  var _info_languageService_getProgram;\n  return (_info_languageService_getProgram = info.languageService.getProgram()) == null ? void 0 : _info_languageService_getProgram.getSourceFile(fileName);\n}\nfunction removeStringQuotes(str) {\n  return str.replace(/^['\"`]|['\"`]$/g, \"\");\n}\nconst isPositionInsideNode = (position, node) => {\n  const start = node.getFullStart();\n  return start <= position && position <= node.getFullWidth() + start;\n};\nconst isDefaultFunctionExport = node => {\n  if (ts.isFunctionDeclaration(node)) {\n    let hasExportKeyword = false;\n    let hasDefaultKeyword = false;\n    if (node.modifiers) {\n      for (const modifier of node.modifiers) {\n        if (modifier.kind === ts.SyntaxKind.ExportKeyword) {\n          hasExportKeyword = true;\n        } else if (modifier.kind === ts.SyntaxKind.DefaultKeyword) {\n          hasDefaultKeyword = true;\n        }\n      }\n    }\n    // `export default function`\n    if (hasExportKeyword && hasDefaultKeyword) {\n      return true;\n    }\n  }\n  return false;\n};\nconst isInsideApp = filePath => {\n  return appDirRegExp.test(filePath);\n};\nconst isAppEntryFile = filePath => {\n  return appDirRegExp.test(filePath) && /^(page|layout)\\.(mjs|js|jsx|ts|tsx)$/.test(_path.default.basename(filePath));\n};\nconst isPageFile = filePath => {\n  return appDirRegExp.test(filePath) && /^page\\.(mjs|js|jsx|ts|tsx)$/.test(_path.default.basename(filePath));\n};\nfunction getIsClientEntry(fileName, throwOnInvalidDirective) {\n  const source = getSource(fileName);\n  if (source) {\n    let isClientEntry = false;\n    let isDirective = true;\n    ts.forEachChild(source, node => {\n      if (ts.isExpressionStatement(node) && ts.isStringLiteral(node.expression)) {\n        if (node.expression.text === \"use client\") {\n          if (isDirective) {\n            isClientEntry = true;\n          } else {\n            if (throwOnInvalidDirective) {\n              const e = {\n                messageText: 'The `\"use client\"` directive must be put at the top of the file.',\n                start: node.expression.getStart(),\n                length: node.expression.getWidth()\n              };\n              throw e;\n            }\n          }\n        }\n      } else {\n        isDirective = false;\n      }\n    });\n    return isClientEntry;\n  }\n  return false;\n}","map":{"version":3,"names":["log","init","getTs","getInfo","getTypeChecker","getSource","removeStringQuotes","isPositionInsideNode","isDefaultFunctionExport","isInsideApp","isAppEntryFile","isPageFile","getIsClientEntry","ts","info","appDirRegExp","message","project","projectService","logger","opts","projectDir","getCurrentDirectory","RegExp","replace","_info_languageService_getProgram","languageService","getProgram","fileName","getSourceFile","str","position","node","start","getFullStart","getFullWidth","isFunctionDeclaration","hasExportKeyword","hasDefaultKeyword","modifiers","modifier","kind","SyntaxKind","ExportKeyword","DefaultKeyword","filePath","test","_path","default","basename","throwOnInvalidDirective","source","isClientEntry","isDirective","forEachChild","isExpressionStatement","isStringLiteral","expression","text","e","messageText","getStart","length","getWidth"],"sources":["../../../src/server/typescript/utils.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}