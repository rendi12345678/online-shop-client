{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  sendEtagResponse: null,\n  sendRenderResult: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  sendEtagResponse: function () {\n    return sendEtagResponse;\n  },\n  sendRenderResult: function () {\n    return sendRenderResult;\n  }\n});\nconst _utils = require(\"../shared/lib/utils\");\nconst _etag = require(\"./lib/etag\");\nconst _fresh = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/fresh\"));\nconst _revalidate = require(\"./lib/revalidate\");\nconst _approuterheaders = require(\"../client/components/app-router-headers\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction sendEtagResponse(req, res, etag) {\n  if (etag) {\n    /**\n    * The server generating a 304 response MUST generate any of the\n    * following header fields that would have been sent in a 200 (OK)\n    * response to the same request: Cache-Control, Content-Location, Date,\n    * ETag, Expires, and Vary. https://tools.ietf.org/html/rfc7232#section-4.1\n    */\n    res.setHeader(\"ETag\", etag);\n  }\n  if ((0, _fresh.default)(req.headers, {\n    etag\n  })) {\n    res.statusCode = 304;\n    res.end();\n    return true;\n  }\n  return false;\n}\nasync function sendRenderResult({\n  req,\n  res,\n  result,\n  type,\n  generateEtags,\n  poweredByHeader,\n  revalidate\n}) {\n  if ((0, _utils.isResSent)(res)) {\n    return;\n  }\n  if (poweredByHeader && type === \"html\") {\n    res.setHeader(\"X-Powered-By\", \"Next.js\");\n  }\n  if (typeof revalidate !== \"undefined\") {\n    res.setHeader(\"Cache-Control\", (0, _revalidate.formatRevalidate)(revalidate));\n  }\n  const payload = result.isDynamic ? null : result.toUnchunkedString();\n  if (payload !== null) {\n    const etag = generateEtags ? (0, _etag.generateETag)(payload) : undefined;\n    if (sendEtagResponse(req, res, etag)) {\n      return;\n    }\n  }\n  if (!res.getHeader(\"Content-Type\")) {\n    res.setHeader(\"Content-Type\", result.contentType ? result.contentType : type === \"rsc\" ? _approuterheaders.RSC_CONTENT_TYPE_HEADER : type === \"json\" ? \"application/json\" : \"text/html; charset=utf-8\");\n  }\n  if (payload) {\n    res.setHeader(\"Content-Length\", Buffer.byteLength(payload));\n  }\n  if (req.method === \"HEAD\") {\n    res.end(null);\n    return;\n  }\n  if (payload !== null) {\n    res.end(payload);\n    return;\n  }\n  // Pipe the render result to the response after we get a writer for it.\n  await result.pipeToNodeResponse(res);\n}","map":{"version":3,"names":["sendEtagResponse","sendRenderResult","req","res","etag","setHeader","_fresh","default","headers","statusCode","end","result","type","generateEtags","poweredByHeader","revalidate","_utils","isResSent","_revalidate","formatRevalidate","payload","isDynamic","toUnchunkedString","_etag","generateETag","undefined","getHeader","contentType","_approuterheaders","RSC_CONTENT_TYPE_HEADER","Buffer","byteLength","method","pipeToNodeResponse"],"sources":["../../src/server/send-payload.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;EAUgBA,gBAAgB,WAAAA,CAAA;WAAhBA,gBAAA;;EAwBMC,gBAAgB,WAAAA,CAAA;WAAhBA,gBAAA;;;uBA9BI;sBACG;6DACX;4BACe;kCACO;;;;;;AAEjC,SAASD,iBACdE,GAAoB,EACpBC,GAAmB,EACnBC,IAAwB;EAExB,IAAIA,IAAA,EAAM;IACR;;;;;;IAMAD,GAAA,CAAIE,SAAS,CAAC,QAAQD,IAAA;EACxB;EAEA,IAAI,IAAAE,MAAA,CAAAC,OAAK,EAACL,GAAA,CAAIM,OAAO,EAAE;IAAEJ;EAAK,IAAI;IAChCD,GAAA,CAAIM,UAAU,GAAG;IACjBN,GAAA,CAAIO,GAAG;IACP,OAAO;EACT;EAEA,OAAO;AACT;AAEO,eAAeT,iBAAiB;EACrCC,GAAG;EACHC,GAAG;EACHQ,MAAM;EACNC,IAAI;EACJC,aAAa;EACbC,eAAe;EACfC;AAAU,CASX;EACC,IAAI,IAAAC,MAAA,CAAAC,SAAS,EAACd,GAAA,GAAM;IAClB;EACF;EAEA,IAAIW,eAAA,IAAmBF,IAAA,KAAS,QAAQ;IACtCT,GAAA,CAAIE,SAAS,CAAC,gBAAgB;EAChC;EAEA,IAAI,OAAOU,UAAA,KAAe,aAAa;IACrCZ,GAAA,CAAIE,SAAS,CAAC,iBAAiB,IAAAa,WAAA,CAAAC,gBAAgB,EAACJ,UAAA;EAClD;EAEA,MAAMK,OAAA,GAAUT,MAAA,CAAOU,SAAS,GAAG,OAAOV,MAAA,CAAOW,iBAAiB;EAElE,IAAIF,OAAA,KAAY,MAAM;IACpB,MAAMhB,IAAA,GAAOS,aAAA,GAAgB,IAAAU,KAAA,CAAAC,YAAY,EAACJ,OAAA,IAAWK,SAAA;IACrD,IAAIzB,gBAAA,CAAiBE,GAAA,EAAKC,GAAA,EAAKC,IAAA,GAAO;MACpC;IACF;EACF;EAEA,IAAI,CAACD,GAAA,CAAIuB,SAAS,CAAC,iBAAiB;IAClCvB,GAAA,CAAIE,SAAS,CACX,gBACAM,MAAA,CAAOgB,WAAW,GACdhB,MAAA,CAAOgB,WAAW,GAClBf,IAAA,KAAS,QACTgB,iBAAA,CAAAC,uBAAuB,GACvBjB,IAAA,KAAS,SACT,qBACA;EAER;EAEA,IAAIQ,OAAA,EAAS;IACXjB,GAAA,CAAIE,SAAS,CAAC,kBAAkByB,MAAA,CAAOC,UAAU,CAACX,OAAA;EACpD;EAEA,IAAIlB,GAAA,CAAI8B,MAAM,KAAK,QAAQ;IACzB7B,GAAA,CAAIO,GAAG,CAAC;IACR;EACF;EAEA,IAAIU,OAAA,KAAY,MAAM;IACpBjB,GAAA,CAAIO,GAAG,CAACU,OAAA;IACR;EACF;EAEA;EACA,MAAMT,MAAA,CAAOsB,kBAAkB,CAAC9B,GAAA;AAClC"},"metadata":{},"sourceType":"script","externalDependencies":[]}