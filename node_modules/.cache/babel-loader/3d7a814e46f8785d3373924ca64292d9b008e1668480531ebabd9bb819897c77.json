{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"PagesAPIRouteMatcherProvider\", {\n  enumerable: true,\n  get: function () {\n    return PagesAPIRouteMatcherProvider;\n  }\n});\nconst _isapiroute = require(\"../../../lib/is-api-route\");\nconst _constants = require(\"../../../shared/lib/constants\");\nconst _routekind = require(\"../route-kind\");\nconst _pagesapiroutematcher = require(\"../route-matchers/pages-api-route-matcher\");\nconst _manifestroutematcherprovider = require(\"./manifest-route-matcher-provider\");\nconst _pages = require(\"../normalizers/built/pages\");\nclass PagesAPIRouteMatcherProvider extends _manifestroutematcherprovider.ManifestRouteMatcherProvider {\n  constructor(distDir, manifestLoader, i18nProvider) {\n    super(_constants.PAGES_MANIFEST, manifestLoader);\n    this.i18nProvider = i18nProvider;\n    this.normalizers = new _pages.PagesNormalizers(distDir);\n  }\n  async transform(manifest) {\n    // This matcher is only for Pages API routes.\n    const pathnames = Object.keys(manifest).filter(pathname => (0, _isapiroute.isAPIRoute)(pathname));\n    const matchers = [];\n    for (const page of pathnames) {\n      if (this.i18nProvider) {\n        // Match the locale on the page name, or default to the default locale.\n        const {\n          detectedLocale,\n          pathname\n        } = this.i18nProvider.analyze(page);\n        matchers.push(new _pagesapiroutematcher.PagesAPILocaleRouteMatcher({\n          kind: _routekind.RouteKind.PAGES_API,\n          pathname,\n          page,\n          bundlePath: this.normalizers.bundlePath.normalize(page),\n          filename: this.normalizers.filename.normalize(manifest[page]),\n          i18n: {\n            locale: detectedLocale\n          }\n        }));\n      } else {\n        matchers.push(new _pagesapiroutematcher.PagesAPIRouteMatcher({\n          kind: _routekind.RouteKind.PAGES_API,\n          // In `pages/`, the page is the same as the pathname.\n          pathname: page,\n          page,\n          bundlePath: this.normalizers.bundlePath.normalize(page),\n          filename: this.normalizers.filename.normalize(manifest[page])\n        }));\n      }\n    }\n    return matchers;\n  }\n}","map":{"version":3,"names":["PagesAPIRouteMatcherProvider","_manifestroutematcherprovider","ManifestRouteMatcherProvider","constructor","distDir","manifestLoader","i18nProvider","_constants","PAGES_MANIFEST","normalizers","_pages","PagesNormalizers","transform","manifest","pathnames","Object","keys","filter","pathname","_isapiroute","isAPIRoute","matchers","page","detectedLocale","analyze","push","_pagesapiroutematcher","PagesAPILocaleRouteMatcher","kind","_routekind","RouteKind","PAGES_API","bundlePath","normalize","filename","i18n","locale","PagesAPIRouteMatcher"],"sources":["../../../../src/server/future/route-matcher-providers/pages-api-route-matcher-provider.ts"],"sourcesContent":[null],"mappings":";;;;;+BAea;;;WAAAA,4BAAA;;;4BAfc;2BACI;2BACL;sCAInB;8CAKsC;uBAEZ;AAE1B,MAAMA,4BAAA,SAAqCC,6BAAA,CAAAC,4BAA4B;EAG5EC,YACEC,OAAe,EACfC,cAA8B,EACbC,YAAA,EACjB;IACA,KAAK,CAACC,UAAA,CAAAC,cAAc,EAAEH,cAAA;wBAFLC,YAAA;IAIjB,IAAI,CAACG,WAAW,GAAG,IAAIC,MAAA,CAAAC,gBAAgB,CAACP,OAAA;EAC1C;EAEA,MAAgBQ,UACdC,QAAkB,EAC4B;IAC9C;IACA,MAAMC,SAAA,GAAYC,MAAA,CAAOC,IAAI,CAACH,QAAA,EAAUI,MAAM,CAAEC,QAAA,IAC9C,IAAAC,WAAA,CAAAC,UAAU,EAACF,QAAA;IAGb,MAAMG,QAAA,GAAwC,EAAE;IAEhD,KAAK,MAAMC,IAAA,IAAQR,SAAA,EAAW;MAC5B,IAAI,IAAI,CAACR,YAAY,EAAE;QACrB;QACA,MAAM;UAAEiB,cAAc;UAAEL;QAAQ,CAAE,GAAG,IAAI,CAACZ,YAAY,CAACkB,OAAO,CAACF,IAAA;QAE/DD,QAAA,CAASI,IAAI,CACX,IAAIC,qBAAA,CAAAC,0BAA0B,CAAC;UAC7BC,IAAA,EAAMC,UAAA,CAAAC,SAAS,CAACC,SAAS;UACzBb,QAAA;UACAI,IAAA;UACAU,UAAA,EAAY,IAAI,CAACvB,WAAW,CAACuB,UAAU,CAACC,SAAS,CAACX,IAAA;UAClDY,QAAA,EAAU,IAAI,CAACzB,WAAW,CAACyB,QAAQ,CAACD,SAAS,CAACpB,QAAQ,CAACS,IAAA,CAAK;UAC5Da,IAAA,EAAM;YACJC,MAAA,EAAQb;UACV;QACF;MAEJ,OAAO;QACLF,QAAA,CAASI,IAAI,CACX,IAAIC,qBAAA,CAAAW,oBAAoB,CAAC;UACvBT,IAAA,EAAMC,UAAA,CAAAC,SAAS,CAACC,SAAS;UACzB;UACAb,QAAA,EAAUI,IAAA;UACVA,IAAA;UACAU,UAAA,EAAY,IAAI,CAACvB,WAAW,CAACuB,UAAU,CAACC,SAAS,CAACX,IAAA;UAClDY,QAAA,EAAU,IAAI,CAACzB,WAAW,CAACyB,QAAQ,CAACD,SAAS,CAACpB,QAAQ,CAACS,IAAA,CAAK;QAC9D;MAEJ;IACF;IAEA,OAAOD,QAAA;EACT;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}